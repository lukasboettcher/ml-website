# Official framework image. Look for the different tagged releases at:
# https://hub.docker.com/r/library/node/tags/
image: node:lts

# This folder is cached between builds
# https://docs.gitlab.com/ee/ci/yaml/index.html#cache
cache:
  paths:
    - node_modules/

lint:
  script: |
    npm run lint

build_deploy:
  before_script:
    - apt-get update -y && apt-get install -y rsync
    - chmod 600 ${SSH_KEY}
  script: |
    npm ci
    npm run build:apache
    rsync -av --del dist/ml-website/ -e "ssh -i ${SSH_KEY} -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null" ${SSH_USER}@${DEPLOY_HOST}:/var/www/mlwebsite/ki